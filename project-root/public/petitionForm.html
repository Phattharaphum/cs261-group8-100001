<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Petition Form</title>
</head>
<body>
    <h1>Petition Form</h1>
    <form id="petitionForm" action="/submit-petition" method="post" enctype="multipart/form-data">
        <label for="student_id">รหัสนักศึกษา:</label>
        <input type="text" id="student_id" name="student_id" autocomplete="off" required><br>
    
        <label for="student_name">ชื่อนักศึกษา:</label>
        <input type="text" id="student_name" name="student_name" autocomplete="name" required><br>
    
        <label for="major">สาขาวิชา:</label>
        <input type="text" id="major" name="major" autocomplete="organization" required><br>
    
        <label for="year">ปีการศึกษา:</label>
        <input type="number" id="year" name="year" autocomplete="off" required><br>
    
        <label for="address">ที่อยู่:</label>
        <textarea id="address" name="address" autocomplete="street-address" required></textarea><br>
    
        <label for="student_phone">เบอร์โทรนักศึกษา:</label>
        <input type="tel" id="student_phone" name="student_phone" autocomplete="tel" required><br>
    
        <label for="guardian_phone">เบอร์โทรผู้ปกครอง:</label>
        <input type="tel" id="guardian_phone" name="guardian_phone" autocomplete="tel" required><br>
    
        <label for="petition_type">ประเภทคำร้อง:</label>
        <input type="text" id="petition_type" name="petition_type" autocomplete="off" required><br>
    
        <label for="semester">ภาคการศึกษา:</label>
        <input type="text" id="semester" name="semester" autocomplete="off" required><br>
    
        <label for="subject_code">รหัสวิชา:</label>
        <input type="text" id="subject_code" name="subject_code" autocomplete="off"><br>
    
        <label for="subject_name">ชื่อวิชา:</label>
        <input type="text" id="subject_name" name="subject_name" autocomplete="off"><br>
    
        <label for="section">ตอนเรียน:</label>
        <input type="text" id="section" name="section" autocomplete="off"><br>
    
        <!-- ส่วนไฟล์แนบที่เพิ่มการเข้าถึง -->
        <div class="document-section">
            <h3>ไฟล์แนบ 1</h3>
            <input type="file" id="file1" name="file1" title="อัปโหลดไฟล์ของคุณ">
            <input type="text" id="filename1" name="filename1" placeholder="ใส่ชื่อไฟล์">
            <input type="text" id="desc1" name="desc1" placeholder="ใส่คำอธิบาย">
            <button type="button" onclick="uploadFile('file1')">บันทึกไฟล์</button>
        </div>
        
        <!-- ไฟล์แนบ 2 -->
        <div class="document-section">
            <h3>ไฟล์แนบ 2</h3>
            <input type="file" id="file2" name="file2" title="อัปโหลดไฟล์ของคุณ">
            <input type="text" id="filename2" name="filename2" placeholder="ใส่ชื่อไฟล์">
            <input type="text" id="desc2" name="desc2" placeholder="ใส่คำอธิบาย">
            <button type="button" onclick="uploadFile('file2')">บันทึกไฟล์</button>
        </div>
        
        <!-- ไฟล์แนบ 3 -->
        <div class="document-section">
            <h3>ไฟล์แนบ 3</h3>
            <input type="file" id="file3" name="file3" title="อัปโหลดไฟล์ของคุณ">
            <input type="text" id="filename3" name="filename3" placeholder="ใส่ชื่อไฟล์">
            <input type="text" id="desc3" name="desc3" placeholder="ใส่คำอธิบาย">
            <button type="button" onclick="uploadFile('file3')">บันทึกไฟล์</button>
        </div>
        <p id="message"></p>
        <button type="button" onclick="submitForm(1)">บันทึกเป็นฉบับร่าง</button>
        <button type="button" onclick="submitForm(2)">ส่งคำร้อง</button>
    </form>
    

    <script>
    async function submitForm(status) {
    console.log('Submitting form with status:', status);
    const formData = new FormData(document.getElementById('petitionForm'));
    formData.append('status', status);

    const url = '/submit-petition';
    try {
        const response = await fetch(url, {
            method: 'POST',
            body: formData
        });

        console.log('Response status:', response.status);
        if (!response.ok) {
            throw new Error(`Server error: ${response.status}`);
        }

        const result = await response.json();
        console.log('Server response:', result);

        if (result.success) {
            window.location.href = status === 1 ? '/draft-petitions-page' : '/studentPetitions';
        } else {
            alert('Error: ' + result.message);
        }
    } catch (error) {
        console.error('Error submitting form:', error);
    }
}
//มันไม่เชิงอัปโหลดอะมันเหมือนปุ่มไว้กดเพื่อเช็คความถูกต้องของไฟล์แถนทำงานผิด

/*async function uploadFile(fileInputId) {
    const fileInput = document.getElementById(fileInputId);
    const file = fileInput.files[0];
    const formData = new FormData();

    if (file) {
        formData.append(fileInputId, file);
        formData.append("filename", document.getElementById(`filename${fileInputId.slice(-1)}`).value);
        formData.append("description", document.getElementById(`desc${fileInputId.slice(-1)}`).value);

        try {
            const response = await fetch('/upload-file', {
                method: 'POST',
                body: formData
            });

            const contentType = response.headers.get("content-type");
            if (contentType && contentType.includes("application/json")) {
                const result = await response.json();
                if (result.success) {
                    alert(result.message);
                } else {
                    alert("ข้อผิดพลาดในการอัปโหลดไฟล์: " + result.message);
                    fileInput.value = ""; // ลบไฟล์ที่ไม่ผ่านเงื่อนไขออกจากช่องไฟล์
                }
            } else {
                // ถ้าประเภทเนื้อหาไม่ใช่ JSON อาจเป็น HTML ซึ่งแสดงถึงข้อผิดพลาดบางอย่าง
                const errorText = await response.text();
                console.error('Unexpected response:', errorText);
                alert('เกิดข้อผิดพลาด: ไม่สามารถอัปโหลดไฟล์ได้');
            }
        } catch (error) {
            console.error('Error uploading file:', error);
            alert('ไม่สามารถอัปโหลดไฟล์ได้: ' + error.message);
        }
    } else {
        alert("กรุณาเลือกไฟล์ก่อนอัปโหลด");
    }
}*/
    </script>
</body>
</html>
