<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ตรวจสอบคำร้อง</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700;900&display=swap" as="style" onload="this.rel='stylesheet'">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Bai+Jamjuree:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700&display=swap" as="style" onload="this.rel='stylesheet'">
    <link rel="stylesheet" href="css/studentPetitionsChecked.css">
    <style>
                /* สไตล์สำหรับแถบสถานะ */
                .status-label {
            padding: 5px 10px;
            border-radius: 15px;
            color: white;
            font-weight: bold;
        }
        .status-waiting { background-color: #FFE6A7; color: #B68900; }
        .status-read { background-color: #E0B0FF; color: #8E44AD; }
        .status-rejected { background-color: #FFCDD2; color: #C62828; }
        .status-approved { background-color: #A5D6A7; color: #2E7D32; }
        .status-canceled { background-color: #BBDEFB; color: #1565C0; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar Section (20%) -->
        <div class="left"></div>
        
        <!-- Main Content Section (80%) -->
        <div class="middle">
            <h2 class="rounded-border" id="topmain">คำร้องขอจดทะเบียนล่าช้า</h2>
            <h3 class="bold-text">ข้อมูลผู้ยื่นคำร้อง</h3>
            <dd>
                <p>ผู้ยื่น :<span id="student_name"> </span></p>
                <p>เลขทะเบียน :<span id="student_id"> </span></p>
                <p>ชั้นปีที่ :<span id="year"> </span></p>
                <p>สาขาวิชา :<span id="major"> </span></p>
                <p>ที่อยู่ที่ติดต่อได้ :<span id="house_number"> </span></p>
                <p>แขวง/ตำบล :<span id="sub_district"> </span></p>
                <p>เขต/อำเภอ :<span id="district"> </span></p>
                <p>จังหวัด :<span id="province"> </span></p>
                <p>รหัสไปรษณีย์ :<span id="postcode"> </span></p>
                <p>โทรศัพท์ติดต่อกับนักศึกษา :<span id="student_phone"> </span></p>
                <p>ติดต่อผู้ปกครอง :<span id="guardian_phone"> </span></p>
            </dd>
            <hr>
            <h3 class="bold-text">คำร้อง</h3>
            <dd>
                <p>ประเภท :<span id="petition_type"> </span></p>
                <p>รหัสวิชา :<span id="subject_code"> </span></p>
                <p>ชื่อวิชา :<span id="subject_name"> </span></p>
                <p>กลุ่มเรียน :<span id="section"> </span></p>
            </dd>
            <hr>
            <h3 class="bold-text">เอกสารประกอบคำร้อง</h3>
            <div class="file">
                <div class="box-container">
                    <div class="top">เอกสารแนบที่ 1</div>
                    <div class="box"></div>
                    <div class="bottom"><span id="file1_name">ชื่อไฟล์</span></div>
                    <div class="bottom"><p style="color: #464646;">คำอธิบาย</p></div>
                </div>
                <div class="box-container">
                    <div class="top">เอกสารแนบที่ 2</div>
                    <div class="box"></div>
                    <div class="bottom"><span id="file2_name">ชื่อไฟล์</span></div>
                    <div class="bottom"><p style="color: #464646;">คำอธิบาย</p></div>
                </div>
            </div>
        </div>

        <!-- Status Section -->
        <div class="right">
            <h3 style="text-align: left;">สถานะคำร้อง</h3>
            <div class="rounded-border2">
                <p>ยื่นคำร้องไปแล้วเมื่อ: <span id="submit_time"> </span></p>
                <p><span id="status"> </span></p>
            </div>
        </div>

        <!-- Back Button -->
        <button class="back-botton" onclick="goBack()">ย้อนกลับ</button>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const petitionId = urlParams.get('id');
                // ฟังก์ชันแสดงสถานะพร้อมแถบสี
                function getStatusText(status) {
            switch(status) {
                case 2: return '<span class="status-label status-waiting">ยื่นไปแล้ว รออยู่</span>';
                case 3: return '<span class="status-label status-read">อ่านแล้ว</span>';
                case 4: return '<span class="status-label status-rejected">ไม่อนุมัติ</span>';
                case 5: return '<span class="status-label status-approved">อนุมัติแล้ว</span>';
                case 6: return '<span class="status-label status-canceled">ยกเลิก</span>';
                default: return '<span class="status-label">ไม่ทราบสถานะ</span>';
            }
        }

                // ฟังก์ชันแสดงประเภทคำร้อง
                function getPetitionType(type) {
            switch(parseInt(type)) {
                case 1: return 'จดทะเบียนล่าช้า';
                case 2: return 'ถอนรายวิชา';
                case 3: return 'จดทะเบียนศึกษารายวิชาข้ามหลักสูตร';
                case 4: return 'ลาออก';
                default: return 'ไม่ทราบประเภท';
            }
        }

        // Fetch petition details
        fetch(`/student/petition-details/${petitionId}`)
            .then(response => response.json())
            .then(data => {
                document.getElementById('student_name').textContent = data.student_name || '';
                document.getElementById('student_id').textContent = data.student_id || '';
                document.getElementById('year').textContent = data.year || '';
                document.getElementById('major').textContent = data.major || '';
                document.getElementById('house_number').textContent = data.house_number || '';
                document.getElementById('sub_district').textContent = data.sub_district || '';
                document.getElementById('district').textContent = data.district || '';
                document.getElementById('province').textContent = data.province || '';
                document.getElementById('postcode').textContent = data.postcode || '';
                document.getElementById('student_phone').textContent = data.student_phone || '';
                document.getElementById('guardian_phone').textContent = data.guardian_phone || '';

                document.getElementById('petition_type').textContent = getPetitionType(data.petition_type) || '';
                document.getElementById('subject_code').textContent = data.subject_code || '';
                document.getElementById('subject_name').textContent = data.subject_name || '';
                document.getElementById('section').textContent = data.section || '';
                document.getElementById('submit_time').textContent = new Date(data.submit_time).toLocaleString() || '';
                document.getElementById('status').innerHTML = getStatusText(data.status);

                document.getElementById("topmain").innerText = "แบบคำร้อง"+getPetitionType(data.petition_type);

                document.getElementById('file1_name').textContent = data.file1_name || 'ไม่มีไฟล์แนบ';
                document.getElementById('file2_name').textContent = data.file2_name || 'ไม่มีไฟล์แนบ';
            })
            .catch(error => console.error('Error fetching petition details:', error));

        function goBack() {
            window.location.href = '/studentPetitions.html';
        }
    </script>
</body>
</html>
